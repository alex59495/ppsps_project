<div class="container mb-3">
  <%= link_to "Revenir à mes PPSP", ppsps_path, class: 'link' %>
  <%= simple_form_for @ppsp, remote: true do |f| %>
    <div class="row">
      <h2 class="col-12 form-title">
        Renseignements administratifs
      </h2>
      <%= f.simple_fields_for :project_information, @project_information do |h| %>
        <div class="col-md-6 offset-md-3">
          <%= h.input :reference, label: "Référence du projet", placeholder: "B 484..." %>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= h.input :responsible, label: "Responsable", placeholder: "Entrez le nom du responsable..." %>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= h.input :phone, label: "Téléphone", placeholder: "Entrez le numéro de téléphone du responsable..." %>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= h.input :email, label: "Email", placeholder: "Entrez l'email du responsable..."  %>
        </div>
        <%= h.simple_fields_for :site_manager, @site_manager do |j| %>
          <div class="col-md-6 offset-md-3">
            <%= j.input :name, label: "Chef de chantier", placeholder: "Entrez le nom du chef de chantier..."  %>
          </div>
          <div class="col-md-6 offset-md-3">
            <%= j.input :phone, label: "Téléphone", placeholder: "Entrez le numéro de téléphone du chef de chantier..."  %>
          </div>
          <div class="col-md-6 offset-md-3">  
            <%= j.input :email, label: "Email", placeholder: "Entrez l'email du chef de chantier..."  %>
          </div>
        <% end %>
        <%= h.simple_fields_for :team_manager, @team_manager do |k| %>
        <div class="col-md-6 offset-md-3">
          <%= k.input :name, label: "Chef d'équipe", placeholder: "Entrez le nom du chef d'équipe..." %>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= k.input :phone, label: "Téléphone", placeholder: "Entrez le numéro de téléphone du chef d'équipe..."  %>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= k.input :email, label: "Email", placeholder: "Entrez l'email du chef d'équipe..." %>
        </div>
        <% end %>
      <% end %>

      <h3 class="col-12 form-subtitle">
        Les sous-traitants
      </h3>
      <div class="col-md-10 offset-md-1">
        <div id="react-render-subcontractors" data-admin=<%= "#{current_user.admin}" %> data-ppsps_id=<%="#{@ppsp.id}"%>></div>
      </div>
      
      <h3 class="col-12 form-subtitle">
        Les correspondants
      </h3>
      <div class="col-md-6">
        <div class="form-group select required ppsp_moa_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_moa_id">MOA <abbr title="required">*</abbr></label>
            <% if policy(Moa).new? %>
              <%= render 'btn_add_database', data: 'Moa' %>
            <% end %>
          </div>
          <%= f.input :moa_id, as: :select, label: false, collection: @moas, label_method: lambda {|x| "#{x.name} - #{x.representative}"}, input_html: {class: "select-2"} %>
        </div>
      </div>
      <div class="col-md-6">
        <div class="form-group select required ppsp_moe_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_moe_id">MOE <abbr title="required">*</abbr></label>
            <% if policy(Moe).new? %>
              <%= render 'btn_add_database', data: 'Moe' %>
            <% end %>
          </div>
          <%= f.input :moe_id, as: :select, label: false, collection: @moes, label_method: lambda {|x| "#{x.name} - #{x.representative}"}, input_html: {class: "select-2"} %>
        </div>
      </div>

      <h3 class="col-12 form-subtitle container-header-for">
        Le Coordonnateur Sécurité<i style='font-size: 0.7em; margin-left: 8px;'>(laissez vide si il n'y en a pas)</i>
        <% if policy(SecurityCoordinator).new? %>
          <%= render 'btn_add_database', data: 'SecurityCoordinator' %>
        <% end %>
      </h3>
      <div class="col-md-6 offset-md-3">
        <div class="form-group select required ppsp_security_coordinator_id">
          <%= f.input :security_coordinator_id, as: :select, collection: @security_coordinators, label: false, label_method: lambda { |x| "#{x.name} - #{x.representative}" }, input_html: {class: "select-2"} %>
        </div>
      </div>

      <h3 class="col-12 form-subtitle">
        Organismes de prévention
      </h3>
      <div class="col-md-6 offset-md-3">
        <div class="form-group select required ppsp_regional_committee_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_regional_committee_id">Comité régional de l'OPPBTP <abbr title="required">*</abbr></label>
            <% if policy(RegionalCommittee).create? %>
               <%= render 'btn_add_database', data: 'RegionalCommittee' %>
            <% end %>
          </div>
          <%= f.input :regional_committee_id, as: :select, label: false, collection: @regional_committees, label_method: lambda {|x| "#{x.name}"}, input_html: {class: "select-2"} %>
        </div>
      </div>
      <div class="col-md-6 offset-md-3">
        <div class="form-group select required ppsp_pension_insurance_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_pension_insurance_id">Caisse d'assurance retraite <abbr title="required">*</abbr></label>
            <% if policy(PensionInsurance).create? %>
              <%= render 'btn_add_database', data: 'PensionInsurance' %>
            <% end %>
          </div>
          <%= f.input :pension_insurance_id, as: :select, label: false, collection: @pension_insurances, label_method: lambda {|x| "#{x.address} - #{x.phone}"}, input_html: {class: "select-2"} %>
        </div>
      </div>
      <div class="col-md-6 offset-md-3">
        <div class="form-group select required ppsp_direcct_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_direcct_id">DIRECCT <abbr title="required">*</abbr></label>
            <% if policy(Direcct).create? %>
              <%= render 'btn_add_database', data: 'Direcct' %>
            <% end %>
          </div>
          <%= f.input :direcct_id, as: :select, label: false, collection: @direccts, label_method: lambda {|x| "#{x.address} - #{x.phone}"}, input_html: {class: "select-2"} %>
        </div>
      </div>
      <div class="col-md-6 offset-md-3">
        <div class="form-group select required ppsp_work_medecine_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_work_medecine_id">Médecine du travail <abbr title="required">*</abbr></label>
            <% if policy(WorkMedecine).create? %>
              <%= render 'btn_add_database', data: 'WorkMedecine' %>
            <% end %>
          </div>
          <%= f.input :work_medecine_id, as: :select, label: false, collection: @work_medecines, label_method: lambda {|x| "#{x.address} - #{x.phone}"}, input_html: {class: "select-2"} %>
        </div>
      </div>


      <h2 class="col-12 form-title">
        Chantier
      </h2>
      <%= f.simple_fields_for :worksite, @worksite do |w| %>
        <div class="col-md-6 offset-md-3">
          <%= w.input :address, label: "Adresse", placeholder: "Indiquez une adresse..." %>
        </div>
        <div class="col-md-6 offset-md-3">
          <div class="container-calendar">
            <div class="calendar-box">
              <div class="title">
                Début
              </div>
              <div class="date">
              <%= w.input :start_date, label: false, as: :string, input_html: {id: 'range_start'}, require: true %>
                <div class="date-day-month">
                  <div id="start-day-calendar" class="day">
                    <%= Date.today.to_formatted_s(:short).split(" ").first %>
                  </div>
                  <div id="start-month-calendar" class="month">
                    <%= Date.today.to_formatted_s(:short).split(" ").last %>
                  </div>
                </div>
                <div id="start-year-calendar" class="year">
                  <%= Date.today.to_formatted_s(:long).split(" ").last%>
                </div>
              </div>
            </div>
            <div class="calendar-box">
              <div class="title">
                Fin
              </div>
              <div class="date">
              <%= w.input :end_date, label: false, as: :string, input_html: {id: 'range_end'}, require: true %>
                <div class="date-day-month">
                  <div id="end-day-calendar" class="day">
                    <%= Date.today.to_formatted_s(:short).split(" ").first %>
                  </div>
                  <div id="end-month-calendar" class="month">
                    <%= Date.today.to_formatted_s(:short).split(" ").last %>
                  </div>
                </div>
                <div id="end-year-calendar" class="year">
                  <%= Date.today.to_formatted_s(:long).split(" ").last%>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= w.input :nature, label: "Nature du travail", placeholder: "Description des travaux..." %>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= w.input :workforce, label: "Personnel impliqué", placeholder: "1 Chef de chantier, 2 ouvriers..." %>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= w.input :timetable_start, label: "Horaires de début de chantier", placeholder: "1 Chef de chantier, 2 ouvriers..." %>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= w.input :timetable_end, label: "Horaires de fin de chantier", placeholder: "1 Chef de chantier, 2 ouvriers..." %>
        </div>
        <div class="col-md-6 offset-md-3">
          <%= w.input :electrical, label: "Installation électrique sur le chantier", placeholder: "1 Chef de chantier, 2 ouvriers..." %>
        </div>
      <% end %>
      <div class="col-md-10 offset-md-1">
        <div id="react-render-risks" data-ppsps_id=<%=@ppsp.id%>></div>

        <div id="react-render-site-installations" data-ppsps_id=<%=@ppsp.id%>></div>

        <div id="react-render-altitude-works" data-ppsps_id=<%=@ppsp.id%>></div>

        <div class='col-12' id="conductors-form-react" data-ppsps_id=<%=@ppsp.id%>></div>

      </div>

      <h3 class="col-12 form-subtitle">
        Signalisation
      </div>
      <div class="col-md-6 offset-md-3">
        <%= f.input :agglomeration, label: "Agglomération", as: :select, collection: Ppsp::AGGLOMERATIONS %>
      </div>
      <div class="col-md-6 offset-md-3">
        <%= f.input :street_impact, label: "Impact sur voirie", as: :select, collection: Ppsp::STREET_IMPACTS %>
      </div>
      <div class="col-md-6 offset-md-3">
        <%= f.input :river_guidance, label: "Signalisation fluviale", as: :select, collection: Ppsp::RIVER_GUIDANCES %>
      </div>
      <div class="col-md-6 offset-md-3">
      <%= f.input :logo_client, label: "Logo du client (si disponible)", disabled: @ppsp.logo_client.attached? %>
      <img id="newLogo" class='icon-logo' style='display: none'>
      <div class='btn-delete' id="removeUpload" style='display: none;'>Annuler</div>
        <div class="render-logo">
          <%= render 'render_logo_client' %>
        </div>
      </div>


      <h2 class="col-12 form-title">
        Dispositifs en matière de secours et d'évacuation
      </h2>

      <h3 class="col-12 form-subtitle">
        Liste des SSP
      </h4>
      <div id="react-render-lifesavers" data-ppsps_id=<%=@ppsp.id%>></div>

      <h3 class="col-12 form-subtitle">
        Services extérieurs
      </h4>
      <div class="col-md-6 offset-md-3">
        <div class="form-group select required ppsp_demining_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_demining_id">Centre de déminage <abbr title="required">*</abbr></label>
            <% if policy(Demining).create? %>
              <%= render 'btn_add_database', data: 'Demining' %>
            <% end %>
          </div>
          <%= f.input :demining_id, as: :select, label: false, collection: @deminings, label_method: lambda {|x| "#{x.name}"}, input_html: {class: "select-2"} %>
        </div>
      </div>
      <div class="col-md-6 offset-md-3">
        <div class="form-group select required ppsp_sos_hand_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_sos_hand_id">Centre SOS Mains et Doigts<abbr title="required">*</abbr></label>
            <% if policy(SosHand).create? %>
              <%= render 'btn_add_database', data: 'SosHand' %>
            <% end %>
          </div>
            <%= f.input :sos_hand_id, as: :select, label: false, collection: @sos_hands, label_method: lambda {|x| "#{x.name}"}, input_html: {class: "select-2"} %>
        </div>
      </div>
      <div class="col-md-6 offset-md-3">
        <div class="form-group select required ppsp_anti_poison_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_anti_poison_id">Centre anti-poison <abbr title="required">*</abbr></label>
            <% if policy(AntiPoison).create? %>
              <%= render 'btn_add_database', data: 'AntiPoison' %>
            <% end %>
          </div>
          <%= f.input :anti_poison_id, as: :select, label: false, collection: @anti_poisons, label_method: lambda {|x| "#{x.name}"}, input_html: {class: "select-2"} %>
        </div>
      </div>
      <div class="col-md-6 offset-md-3">
        <div class="form-group select required ppsp_hospital_id">
          <div class="container-header-form">
            <label class="select required" for="ppsp_hospital_id">Hôpital le plus proche <abbr title="required">*</abbr></label>
            <% if policy(Hospital).create? %>
              <%= render 'btn_add_database', data: 'Hospital' %>
            <% end %>
          </div>
          <%= f.input :hospital_id, as: :select, collection: @hospitals, label: false, label_method: lambda { |x| "#{x.name}"}, input_html: {class: "select-2"} %>
        </div>
      </div>

      <div class="col-12 form-title">
        Les informations sécurité de l'entreprise
      </div>
      <div class="col-md-10 offset-md-1">
        <input class='hidden' name=image type=file id="upload" onchange="">
        <%= f.text_area :content_secu, class: 'tinymce', 'data-company_secu': current_user.company.content_secu, 'data-ppsp_secu': @ppsp_content_secu %>
        <%= tinymce %>
      </div>


      <div class="col-md-6 offset-md-3 mt-3">
        <%= f.input :annexes, label: "Annexes (si besoin)", input_html: { multiple: true } %>
        <p class="text-alert">Vous pouvez maintenir la touche CTRL enfoncée lors de la sélection pour choisir plusieurs fichiers</p>
      </div>
      <% if @ppsp.annexes.attached? %>
        <div class="d-flex flex-wrap justify-content-center w-100" id='container-annexes'>
          <%= render 'render_annexes' %>
        </div>
      <% end %>


      <div class="col-md-6 offset-md-3 offset-3 offset-md-5 mt-5">
        <%= f.submit "J'ai terminé", class: 'btn-blue' %>
      </div>
    </div>
  <% end %>
  <% if policy(SecurityCoordinator).create? %>
    <div class="modal fade" id="ModalSecurityCoordinator" tabindex="-1" role="dialog" aria-labelledby="ModalSecurityCoordinator" aria-hidden="true">
      <%= render 'ppsps/modal_security_coordinator' %>
    </div>
  <% end %>
  <% if policy(Hospital).create? %>
    <div class="modal fade" id="ModalHospital" tabindex="-1" role="dialog" aria-labelledby="ModalHospital" aria-hidden="true">
      <%= render 'ppsps/modal_hospital' %>
    </div>
  <% end %>
  <% if policy(Moa).create? %>
    <div class="modal fade" id="ModalMoa" tabindex="-1" role="dialog" aria-labelledby="ModalMoa" aria-hidden="true">
      <%= render 'ppsps/modal_moa' %>
    </div>
  <% end %>
  <% if policy(Moe).create? %>
    <div class="modal fade" id="ModalMoe" tabindex="-1" role="dialog" aria-labelledby="ModalMoe" aria-hidden="true">
      <%= render 'ppsps/modal_moe' %>
    </div>
  <% end %>
  <% if policy(Direcct).create? %>
    <div class="modal fade" id="ModalDirecct" tabindex="-1" role="dialog" aria-labelledby="ModalDirecct" aria-hidden="true">
      <%= render 'ppsps/modal_direcct' %>
    </div>
  <% end %>
  <% if policy(PensionInsurance).create? %>
    <div class="modal fade" id="ModalPensionInsurance" tabindex="-1" role="dialog" aria-labelledby="ModalPensionInsurance" aria-hidden="true">
      <%= render 'ppsps/modal_pension_insurance' %>
    </div>
  <% end %>
  <% if policy(RegionalCommittee).create? %>
    <div class="modal fade" id="ModalRegionalCommittee" tabindex="-1" role="dialog" aria-labelledby="ModalRegionalCommittee" aria-hidden="true">
      <%= render 'ppsps/modal_regional_committee' %>
    </div>
  <% end %>
  <% if policy(AntiPoison).create? %>
    <div class="modal fade" id="ModalAntiPoison" tabindex="-1" role="dialog" aria-labelledby="ModalAntiPoison" aria-hidden="true">
      <%= render 'ppsps/modal_anti_poison' %>
    </div>
  <% end %>
  <% if policy(WorkMedecine).create? %>
    <div class="modal fade" id="ModalWorkMedecine" tabindex="-1" role="dialog" aria-labelledby="ModalWorkMedecine" aria-hidden="true">
      <%= render 'ppsps/modal_work_medecine' %>
    </div>
  <% end %>
  <% if policy(SosHand).create? %>
    <div class="modal fade" id="ModalSosHand" tabindex="-1" role="dialog" aria-labelledby="ModalSosHand" aria-hidden="true">
      <%= render 'ppsps/modal_sos_hand' %>
    </div>
  <% end %>
  <% if policy(Demining).create? %>
    <div class="modal fade" id="ModalDemining" tabindex="-1" role="dialog" aria-labelledby="ModalDemining" aria-hidden="true">
      <%= render 'ppsps/modal_demining' %>
    </div>
  <% end %>
</div>
