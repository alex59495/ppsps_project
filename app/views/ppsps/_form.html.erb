<div class="row">
  <div class="col-6 offset-3">
    <%= link_to "Revenir à mes PPSP", ppsps_path %>

    <%# Pas possible de "nester" des forms en HTML5, on utilise donc une technique qui vise a renseigner un id %>
    <%# et à reprendre dans les inputs que l'on souhaite associer à ce form %>
    <form id="FormSecurityCoordinator" action=<%= security_coordinators_path %> method="post"></form>

    <%= simple_form_for @ppsp do |f| %>
      <%= f.input :address, label: "Adresse", placeholder: "Indiquez une adresse..." %>
      <%= f.input :start_date, label: "Date de début"  %>
      <%= f.input :end_date, label: "Date de fin"  %>
      <%= f.input :nature, label: "Nature du travail", placeholder: "Description des travaux..." %>
      <%= f.input :workforce, label: "Personnel impliqué", placeholder: "1 Chef de chantier, 2 ouvriers..." %>
      <div class="form-group select required ppsp_moa_id">
      <div class="d-flex align-items-start">
          <label class="select required" for="ppsp_moa_id">MOA <abbr title="required">*</abbr></label>
          <% if policy(Moa).new? %>
            <button type="button" class="btn-add" data-toggle="modal" data-target="#ModalMoa">
              +
            </button>
          <% end %>
      </div>
        <select class="form-control select required" name="ppsp[moa_id]" id="ppsp_moa_id">
          <option value=""></option>
          <% Moa.all.each do |moa| %>
            <%= "<option value=#{moa.id}>#{moa.name} - #{moa.representative}</option>" %>
          <% end %>
        </select>
      </div>
      <%# <%= f.input :moa_id, label: "MOA", as: :select, collection: Moa.all.order(:name), label_method: lambda { |moa| "#{moa.name} - #{moa.representative}"} %>
      <div class="form-group select required ppsp_moe_id">
        <div class="d-flex align-items-start">
          <label class="select required" for="ppsp_moe_id">MOE <abbr title="required">*</abbr></label>
          <% if policy(Moe).new? %>
            <button type="button" class="btn-add" data-toggle="modal" data-target="#ModalMoe">
              +
            </button>
          <% end %>
        </div>
        <select class="form-control select required" name="ppsp[moe_id]" id="ppsp_moe_id">
          <option value=""></option>
          <% Moe.all.each do |moe| %>
            <%= "<option value=#{moe.id}>#{moe.name} - #{moe.representative}</option>" %>
          <% end %>
        </select>
      </div>
      <%= f.input :moe_id, label: "MOE", as: :select, collection: Moe.all.order(:name) %>
      <%= f.simple_fields_for :project_information, @project_information do |h| %>
        <%= h.input :reference, label: "Référence du projet", placeholder: "B 484..." %>
        <%= h.input :responsible, label: "Responsable", placeholder: "Entrez le nom du responsable..." %>
        <%= h.input :phone, label: "Téléphone", placeholder: "Entrez le numéro de téléphone du responsable..." %>
        <%= h.input :email, label: "Email", placeholder: "Entrez l'email du responsable..."  %>
        <%= h.simple_fields_for :site_manager, @site_manager do |j| %>
          <%= j.input :name, label: "Chef de chantier", placeholder: "Entrez le nom du chef de chantier..."  %>
          <%= j.input :phone, label: "Téléphone", placeholder: "Entrez le numéro de téléphone du chef de chantier..."  %>
          <%= j.input :email, label: "Email", placeholder: "Entrez l'email du chef de chantier..."  %>
        <% end %>
        <%= h.simple_fields_for :team_manager, @team_manager do |k| %>
          <%= k.input :name, label: "Chef d'équipe", placeholder: "Entrez le nom du chef d'équipe..." %>
          <%= k.input :phone, label: "Téléphone", placeholder: "Entrez le numéro de téléphone du chef d'équipe..."  %>
          <%= k.input :email, label: "Email", placeholder: "Entrez l'email du chef d'équipe..." %>
        <% end %>
      <% end %>
      <% if policy(ProjectInformation).new? %>
        <%= link_to "Ajouter un projet", new_project_information_path %>
      <% end %>
      <div class="form-group select required ppsp_regional_committee_id">
        <div class="form-group select required ppsp_moe_id">
          <label class="select required" for="ppsp_regional_committee_id">Comité régional de l'OPPBTP <abbr title="required">*</abbr></label>
          <% if policy(RegionalCommittee).new? %>
            <button type="button" class="btn-add" data-toggle="modal" data-target="#ModalRegionalCommittee">
              +
            </button>
          <% end %>
        </div>
        <select class="form-control select required" name="ppsp[regional_committee_id]" id="ppsp_regional_committee_id">
          <option value=""></option>
          <%= RegionalCommittee.all.each do |regional| %>
            <%= "<option value=#{regional.id}>#{regional.name}</option>" %>
          <% end %>
        </select>
      </div>      
      <%= f.input :pension_insurance_id, label: "Caisse d'assurance retraite", as: :select, collection: PensionInsurance.all.order(:id) %>
      <% if policy(PensionInsurance).new? %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalPensionInsurance">
          Ajouter une Caisse d'assurance
        </button>
      <% end %>
      <%= f.input :direcct_id, label: "DIRECCT", as: :select, collection: Direcct.all.order(:id) %>
      <% if policy(Direcct).new? %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalDirecct">
          Ajouter un DIRECCT
        </button>
      <% end %>
      <%= f.input :work_medecine_id, label: "Médecine du travail", as: :select, collection: WorkMedecine.all.order(:address), label_method: lambda { |instance| "#{instance.address} - #{instance.phone}"} %>
      <% if policy(WorkMedecine).new? %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalWorkMedecine">
          Ajouter un médecin du travail
        </button>
      <% end %>
      <%= f.input :demining_id, label: "Déminage", as: :select, collection: Demining.all.order(:name) %>
      <% if policy(Demining).new? %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalDemining">
          Ajouter un centre de déminage
        </button>
      <% end %>
      <%= f.input :sos_hand_id, label: "SOS Mains et Doigts", as: :select, collection: SosHand.all.order(:name) %>
      <% if policy(SosHand).new? %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalSosHand">
          Ajouter un centre SOS Mains et Doigts
        </button>
      <% end %>
      <%= f.input :anti_poison_id, label: "Centre anti-poison", as: :select, collection: AntiPoison.all.order(:name) %>
      <% if policy(AntiPoison).new? %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalAntiPoison">
          Ajouter un Centre anti poison
        </button>
      <% end %>
      <%= f.input :hospital_id, label: "Hôpital", as: :select, collection: Hospital.all.order(:name) %>
      <% if policy(Hospital).new? %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalHospital">
          Ajouter un Hôpital
        </button>
      <% end %>
      <%= f.input :security_coordinator_id, label: "Coordinateur sécurité", as: :select, collection: SecurityCoordinator.all.order(:name), label_method: lambda { |security| "#{security.name} - #{security.representative}"} %>
      <% if policy(SecurityCoordinator).new? %>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalSecurityCoordinator">
          Ajouter un Coordinateur sécurité
        </button>
      <% end %>
      <%= f.input :agglomeration, label: "Agglomération", as: :select, collection: Ppsp::AGGLOMERATIONS %>
      <%= f.input :street_impact, label: "Impact sur voirie", as: :select, collection: Ppsp::STREET_IMPACTS %>
      <%= f.input :river_guidance, label: "Signalisation fluviale", as: :select, collection: Ppsp::RIVER_GUIDANCES %>
      <% if params[:action] == 'new' %>
        <%= f.submit "Créer un nouveau PPSP" %>
      <% else %>
        <%= f.submit "Mettre à jour le PPSP" %>
      <% end %>
    <% end %>

    <%# Modal Security Coordinator %>
    <% if policy(SecurityCoordinator).new? %>
      <div class="modal fade" id="ModalSecurityCoordinator" tabindex="-1" role="dialog" aria-labelledby="ModalSecurityCoordinator" aria-hidden="true">
        <%= render 'ppsps/modal_security_coordinator' %>
      </div>
    <% end %>
    <%# Modal Hospital %>
    <% if policy(Hospital).new? %>
      <div class="modal fade" id="ModalHospital" tabindex="-1" role="dialog" aria-labelledby="ModalHospital" aria-hidden="true">
        <%= render 'ppsps/modal_hospital' %>
      </div>
    <% end %>
    <%# Modal Moa %>
    <% if policy(Moa).new? %>
      <div class="modal fade" id="ModalMoa" tabindex="-1" role="dialog" aria-labelledby="ModalMoa" aria-hidden="true">
        <%= render 'ppsps/modal_moa' %>
      </div>
    <% end %>
    <%# Modal Moe %>
    <% if policy(Moe).new? %>
      <div class="modal fade" id="ModalMoe" tabindex="-1" role="dialog" aria-labelledby="ModalMoe" aria-hidden="true">
        <%= render 'ppsps/modal_moe' %>
      </div>
    <% end %>
    <%# Modal Direcct %>
    <% if policy(Direcct).new? %>
      <div class="modal fade" id="ModalDirecct" tabindex="-1" role="dialog" aria-labelledby="ModalDirecct" aria-hidden="true">
        <%= render 'ppsps/modal_direcct' %>
      </div>
    <% end %>
    <%# Modal Pension Insurance %>
    <% if policy(PensionInsurance).new? %>
      <div class="modal fade" id="ModalPensionInsurance" tabindex="-1" role="dialog" aria-labelledby="ModalPensionInsurance" aria-hidden="true">
        <%= render 'ppsps/modal_pension_insurance' %>
      </div>
    <% end %>
    <%# Modal Regional Committee %>
    <% if policy(RegionalCommittee).new? %>
      <div class="modal fade" id="ModalRegionalCommittee" tabindex="-1" role="dialog" aria-labelledby="ModalRegionalCommittee" aria-hidden="true">
        <%= render 'ppsps/modal_regional_committee' %>
      </div>
    <% end %>
    <%# Modal Anti_Poison %>
    <% if policy(AntiPoison).new? %>
      <div class="modal fade" id="ModalAntiPoison" tabindex="-1" role="dialog" aria-labelledby="ModalAntiPoison" aria-hidden="true">
        <%= render 'ppsps/modal_anti_poison' %>
      </div>
    <% end %>
    <%# Modal Work Medecine %>
    <% if policy(WorkMedecine).new? %>
      <div class="modal fade" id="ModalWorkMedecine" tabindex="-1" role="dialog" aria-labelledby="ModalWorkMedecine" aria-hidden="true">
        <%= render 'ppsps/modal_work_medecine' %>
      </div>
    <% end %>
    <%# Modal Sos Hand %>
    <% if policy(SosHand).new? %>
      <div class="modal fade" id="ModalSosHand" tabindex="-1" role="dialog" aria-labelledby="ModalSosHand" aria-hidden="true">
        <%= render 'ppsps/modal_sos_hand' %>
      </div>
    <% end %>
    <%# Modal Demining %>
    <% if policy(Demining).new? %>
      <div class="modal fade" id="ModalDemining" tabindex="-1" role="dialog" aria-labelledby="ModalDemining" aria-hidden="true">
        <%= render 'ppsps/modal_demining' %>
      </div>
    <% end %>
  </div>
</div>
