<%= link_to "Revenir à mes PPSP", ppsps_path %>

<%= simple_form_for @ppsp do |f| %>
  <%= f.input :address, label: "Adresse", placeholder: "Indiquez une adresse", input_html: { id: :autocomplete_address } %>
  <%= f.input :start, label: "Date de début"  %>
  <%= f.input :end, label: "Date de fin"  %>
  <%= f.input :nature, label: "Nature du travail"  %>
  <%= f.input :workforce, label: "Workforce"  %>
  <% if policy(Company).new? %>
    <%= link_to "Ajouter une entreprise", new_company_path %>
  <% end %>
  <div class="form-group select required ppsp_moa_id">
    <label class="select required" for="ppsp_moa_id">MOA <abbr title="required">*</abbr></label>
    <select class="form-control select required" name="ppsp[moa_id]" id="ppsp_moa_id">
      <option value=""></option>
      <% Moa.all.order(:name).each do |moa| %>
        <option value=<%= moa.id %>><%= moa.name %> - <%= moa.representative %> </option>
      <% end %>
    </select>
  </div>
  <% if policy(Moa).new? %>
    <%= link_to "Ajouter un MOA", new_moa_path %>
  <% end %>
  <%= f.input :moe_id, label: "MOE", as: :select, collection: Moe.all.order(:name) %>
  <% if policy(Moe).new? %>
    <%= link_to "Ajouter un MOE", new_mo_path %>
  <% end %>
  <div class="form-group select required ppsp_project_information_id">
    <label class="select required" for="ppsp_project_information_id">Projet <abbr title="required">*</abbr></label>
    <select class="form-control select required" name="ppsp[project_information_id]" id="ppsp_project_information_id">
      <option value=""></option>
      <% ProjectInformation.all.order(:reference).each do |project| %>
        <option value=<%= project.id %>><%= "#{project.reference} - #{project.responsible}" %></option>
      <% end %>
    </select>
  </div>
  <% if policy(Moe).new? %>
    <%= link_to "Ajouter un projet", new_project_information_path %>
  <% end %>
  <%= f.input :regional_committee_id, label: "Comité régional de l'OPPBTP", as: :select, collection: RegionalCommittee.all.order(:id) %>
  <% if policy(RegionalCommittee).new? %>
    <%= link_to "Ajouter un comité régional", new_regional_committee_path %>
  <% end %>
  <%= f.input :pension_insurance_id, label: "Caisse d'assurance retraite", as: :select, collection: PensionInsurance.all.order(:id) %>
  <% if policy(PensionInsurance).new? %>
    <%= link_to "Ajouter une caisse d'assurance retraite", new_pension_insurance_path %>
  <% end %>
  <%= f.input :direcct_id, label: "DIRECCT", as: :select, collection: Direcct.all.order(:id) %>
  <% if policy(Direcct).new? %>
    <%= link_to "Ajouter un DIRECCT", new_direcct_path %>
  <% end %>
  <%= f.input :work_medecine_id, label: "Médecine du travail", as: :select, collection: WorkMedecine.all.order(:id) %>
  <% if policy(WorkMedecine).new? %>
    <%= link_to "Ajouter un médecin du travail", new_work_medecine_path %>
  <% end %>
  <%= f.input :demining_id, label: "Déminage", as: :select, collection: Demining.all.order(:name) %>
  <% if policy(Demining).new? %>
    <%= link_to "Ajouter un Centre de déminage", new_demining_path %>
  <% end %>
  <%= f.input :sos_hand_id, label: "SOS Mains et Doigts", as: :select, collection: SosHand.all.order(:name) %>
  <% if policy(SosHand).new? %>
    <%= link_to "Ajouter un centre SOS Mains et Doigts", new_sos_hand_path %>
  <% end %>
  <%= f.input :anti_poison_id, label: "Centre anti-poison", as: :select, collection: AntiPoison.all.order(:name) %>
  <% if policy(AntiPoison).new? %>
    <%= link_to "Ajouter un centre anti-poison", new_anti_poison_path %>
  <% end %>
  <%= f.input :hospital_id, label: "Hôpital", as: :select, collection: Hospital.all.order(:name) %>
  <% if policy(Hospital).new? %>
    <%= link_to "Ajouter un Hôpital", new_hospital_path %>
  <% end %>
  <div class="form-group select optional ppsp_security_coordinator_id">
    <label class="select optional" for="ppsp_security_coordinator_id">Coordinateur sécurité</label>
    <select class="form-control select optional" name="ppsp[security_coordinator_id]" id="ppsp_security_coordinator_id">
      <option value=""></option>
      <% SecurityCoordinator.all.order(:name).each do |sc| %>
        <option value="<%= sc.id%>"><%= "#{sc.name} - #{sc.representative}" %></option>
      <% end %>
    </select></div>
  <% if policy(SecurityCoordinator).new? %>
    <div>
      <input type="checkbox" id="checkSecurityCoordinator" name="securityCoordinator">
      <label for="checkSecurityCoordinator">Ajouter un nouveau coordinateur sécurité ?</label>
    </div>
    <div class="hidden-form hidden" id="securityCoordinator">
      <%= f.fields_for :security_coordinator, @security_coordinator, url: security_coordinators_path do |h| %>
        <%= h.text_field :name, placeholder: "Coordinateur sécurité" %>
        <%= h.text_field :representative, placeholder: "Représentant" %>
        <%= h.text_field :address, placeholder: "Adresse" %>
        <%= h.text_field :phone, placeholder: "Téléphone" %>
        <%= h.text_field :email, placeholder: "Email" %>
      <% end %>
    </div>
  <% end %>
  <%= f.input :agglomeration, label: "Agglomération", as: :select, collection: Ppsp::AGGLOMERATIONS %>
  <%= f.input :street_impact, label: "Impact sur voirie", as: :select, collection: Ppsp::STREET_IMPACTS %>
  <%= f.input :river_guidance, label: "Signalisation fluviale", as: :select, collection: Ppsp::RIVER_GUIDANCES %>
  <%= f.submit %>
<% end %>
